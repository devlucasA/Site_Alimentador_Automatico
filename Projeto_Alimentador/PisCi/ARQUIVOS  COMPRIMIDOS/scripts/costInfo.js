const inputCost=document.querySelector(".input_def"),saveIcon=document.querySelector("#save_icon"),editCostIcon=document.querySelector("#edit_cost"),editGPDIcon=document.querySelector("#edit_GPD"),divMask=document.querySelector(".div_mask"),GPDDiv=document.querySelector(".GPD_card"),lastWeight=document.querySelector("#last_weight"),lastDate=document.getElementById("last_date"),penultWeight=document.querySelector("#penult_weight"),penultDate=document.querySelector("#penult_date"),GPDResult=document.querySelector("#GPD_result"),GPDOutput=document.querySelector("#GPD_output"),TCAReal=document.querySelector("#real_TCA"),TCAExpected=document.querySelector("#expected_TCA"),weekCostOutput=document.querySelector("#week_cost"),relativeCostOutput=document.querySelector("#relative-cost"),msgError=document.getElementById("error_msg");function tableF(){let e=new XMLHttpRequest;e.open("GET","https://script.google.com/macros/s/AKfycbzzRTvVjMW7o6RX9dBHyzuz5xq3uqFOxjsDQlPvbiTIUDtDsrYHp7a-1skzj7XHjgcm/exec"),e.send(),e.onload=function(){let t=e.responseText;JSON.parse(t).data.forEach((e=>{const t=document.querySelector(".tbody"),o=document.createElement("tr"),n=document.createElement("td"),a=document.createElement("td"),s=document.createElement("td");t.appendChild(o),o.appendChild(n),o.appendChild(a),o.appendChild(s),console.log(e),n.innerText=new Date(e[0]).toLocaleDateString(),a.innerText=parseFloat(e[1]).toFixed(2)+" kg",s.innerText="R$ "+parseFloat(e[2]).toFixed(2)}))}}tableF();let atualDate=new Date;const umDiaEmMs=864e5;function PostDataScript(e,t,o){let n=new XMLHttpRequest,a="?date1="+t+"&date2="+o+"&peso1="+penultWeight.value+"&peso2="+lastWeight.value;return n.open("GET",e+a),n.send(),console.log(n.responseText),n.responseText}function validityFunc(){[lastDate,lastWeight,penultDate,penultWeight].forEach((e=>{""==e.value&&(msgError.textContent="Preencha todos os campos")})),Date1=penultDate.value,Date2=lastDate.value,console.log("data1: "+Date1),console.log("data2: "+Date2),new Date(Date1)>=new Date(Date2)?msgError.textContent="A penúltima biometria deve ter ocorrido antes da última":new Date(Date1)>atualDate||new Date(Date2)>atualDate?msgError.textContent="Não é possível calcular a partir de uma data futura":PostDataScript("https://script.google.com/macros/s/AKfycbz4ogKCeW8FsKpr-odl-YzfQxao9BvmsGm5Fg4-BTOS7d05dZ-IKKJDFShg3IzzX_TJ/exec",Date1,Date2)}let costFood=0;function editCost(e){inputCost.removeAttribute("disabled"),saveIcon.classList.remove("hidden"),e.classList.add("hidden")}function postCost(){let e=new XMLHttpRequest,t="?date="+(new Date).toLocaleDateString()+"&cost="+inputCost.value;return e.open("GET","https://script.google.com/macros/s/AKfycbwheArqv_AyOrDyni_v05LSg_xs_iuPCgpNMMUwm3imAmGqRzoPvCOewf74srngnG0/exec"+t),e.send(),console.log(e.responseText),inputCost.setAttribute("disabled","disabled"),saveIcon.classList.add("hidden"),editCostIcon.classList.remove("hidden"),console.log("Enviado!"),e.responseText}function getCost(){let e=new XMLHttpRequest;e.open("GET","https://script.google.com/macros/s/AKfycby0Wi2hnInFAaHnHpEh_eLQOtwPYHpwSt7T8N3BnaG_rDth6Zh1Chjkkn8nif_orFaK/exec?read"),e.send(),e.onload=function(){e.responseText.split(",");inputCost.value=e.responseText}}function calcExpectedTCA(e){let t=0;return e<10&&(t=1),e>=10&&e<50&&(t=1.1),e>=50&&e<150&&(t=1.2),e>=150&&e<250&&(t=1.3),e>=250&&e<400&&(t=1.4),e>=400&&e<600&&(t=1.6),e>=600&&e<800&&(t=1.7),e>=800&&e<1300&&(t=1.8),e>1300&&(t=2),t}function getCostInfos(){let e=new XMLHttpRequest;e.open("GET","https://script.google.com/macros/s/AKfycbwl5PcB-M3V8pyeAh95yfImv3gxEk4Nn__lGIAzsuzh3B0ZEmxKpP8451hrwtNbPY_NCA/exec?read"),e.send(),e.onload=function(){let t=e.responseText.split(",");console.log(t),GPDOutput.innerHTML="&nbsp"+parseFloat(t[3]).toFixed(2),TCAReal.innerHTML="&nbsp"+parseFloat(t[4]).toFixed(2);let o=calcExpectedTCA(parseFloat(t[6]).toFixed(2));TCAExpected.innerHTML="&nbsp"+o,relativeCostOutput.innerHTML="&nbsp"+parseFloat(t[5]).toFixed(2),weekCostOutput.innerHTML="&nbsp"+parseFloat(t[6]).toFixed(2)}}function calcGPD(){const e=new Date(lastDate.value),t=new Date(penultDate.value),o=lastWeight.value,n=penultWeight.value,a=Math.abs(e-t)/864e5,s=parseFloat((o-n)/a).toFixed(2);GPDResult.innerHTML=s}function closed(){GPDDiv.classList.add("hidden"),divMask.style.opacity="100%"}function openGPDCard(){divMask.style.opacity="50%",GPDDiv.classList.remove("hidden")}getCost(),getCostInfos();