const amountFoodInput=$("#amount-food"),sendButton=$("#submit"),outputTime=document.querySelector("#output-timestamp"),outputReservoir=document.querySelector("#output-reservoir"),tempMetric=document.getElementById("temp_metric");let qtdFoodReservoir=0;function getFood(){let e=new XMLHttpRequest;e.open("GET","https://script.google.com/macros/s/AKfycbwqbhTaPlHCuBSQMZe0j8BhNxFctzfLAcqphMOA_SjRbRbH8kUYjt9gOXuhF1vQfoimCg/exec"),e.send(),e.onload=function(){let t=e.responseText.split(",");outputReservoir.innerText=t[0]+" kg",qtdFoodReservoir=t[0]}}function openRotor(){const e=document.getElementById("alert");if(console.log(typeof parseFloat(qtdFoodReservoir)),console.log(typeof parseFloat(amountFoodInput.val())),parseFloat(amountFoodInput.val())>parseFloat(qtdFoodReservoir))e.classList.remove("hidden"),e.innerText="A quantidade que você inseriu não pode ser fornecida. Verifique a quantidade de ração no reservatório",setInterval((()=>{e.classList.add("hidden")}),5e3);else if(amountFoodInput.val()<0)e.classList.remove("hidden"),e.innerText="Não é possível colocar números negativos";else{document.querySelector(".notification").classList.remove("hidden"),setInterval((()=>{document.querySelector(".notification").classList.add("hidden")}),8e3),outputReservoir.innerText=parseFloat(qtdFoodReservoir-amountFoodInput.val()).toFixed(2)+" kg";let e=new XMLHttpRequest;e.open("GET","http://192.168.15.12/ledon?foodprovided="+amountFoodInput.val(),!1),e.send();let t=5;parseFloat(5e3*amountFoodInput.val()/t).toFixed(2);console.log(amountFoodInput.val()),setTimeout((()=>{fetch("http://192.168.15.12/ledoff").then((e=>e.json())).then((e=>console.log(e))).catch((e=>console.error(e)))}),5e3),e.open("GET","https://script.google.com/macros/s/AKfycbwUhYvNoGI2RK8oA5Ty78M5vwgi1cut7rmKh7ZeAgCSLTygAbT9Irat7NWOCO--Gjvnrw/exec?qtd="+amountFoodInput.val()),e.send()}}function GetLastFeed(e){let t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t.responseText}function mainFeed(){let e=GetLastFeed("https://script.google.com/macros/s/AKfycbydn9mZm8pI8Fvu82ruIpr6EzJrWSlPjFUI3Y1qwwDL6zkuiYrIlPPs9P71XCG7QbCJ/exec").split(",");const t=new Date(e[4]);outputTime.innerHTML=t.toLocaleDateString()+" - "+t.toLocaleTimeString("pt-BR")}getFood(),sendButton.on("click",(function(){openRotor()})),setInterval((function(){const e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=this.responseText;tempMetric.innerText=e}},e.open("GET","http://192.168.15.12/temp_value",!0),e.send()}),2e3),mainFeed();